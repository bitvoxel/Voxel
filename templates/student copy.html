<html>
  <head>
      <title>Kazhak - Student Console</title>
      <link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
      <style>
          body {
              font-family: "Roboto Mono", monospace;
              background-color: black;
              color: white;
              margin: 0;
              padding: 20px;
          }
          #header_wrapper {
              text-align: center;
              margin-bottom: 20px;
          }
          #student_list, #student_form {
              margin: 20px auto;
              width: 80%;
              border: 1px solid white;
              border-radius: 5px;
              padding: 20px;
              background-color: rgba(4, 10, 27, 0.367);
          }
          table {
              width: 100%;
              border-collapse: collapse;
          }
          th, td {
              padding: 10px;
              text-align: left;
              border: 1px solid white;
          }
          th {
              background-color: rgba(255, 255, 255, 0.066);
          }
          .inp {
              width: calc(30% - 20px);
              margin: 10px;
              padding: 10px;
              border: 1px solid white;
              border-radius: 5px;
              background-color: transparent;
              color: white;
          }
          button {
            font-family: "Roboto Mono", monospace;
    font-optical-sizing: auto;
    font-style: normal;
              padding: 10px 15px;
              border: none;
              border-radius: 5px;
              background-color: black;
              color: white;
              cursor: pointer;
              margin: 10px;

          }
          button:hover {
              background-color: #0082c8;
          }
          #student_form {
            color-scheme: dark;
          }
      </style>
  </head>
  <body>
      <div id="header_wrapper">
          <div id="header">
              <div id="title">Kazhak</div>
              <br>Manage Students
              <nav>
                <ul>
                  <li><a href="/" style="font-size: 3vh;">Chatbot</a></li>
                  <li><a href="/student" style="font-size: 3vh;">Students</a></li>
                  <li><a href="/teacher" style="font-size: 3vh;">Teachers</a></li>
                </ul>
              </nav>
          </div>
      </div>

      <div id="student_list">
        <h2><u>List of Students</u></h2>
        <table id="students_table">
            <thead>
                <tr>
                    <th><u>Roll No</u></th>
                    <th><u>Name</u></th>
                    <th><u>Class</u></th>
                    <th><u>Date of Joining</u></th>
                    <th><u>Date of Birth</u></th>
                    <th><u>Actions</u></th>
                </tr>
            </thead>
            <tbody id="students_body">
                <!-- Student records will be populated here -->
            </tbody>
        </table>
    </div>

      <div id="student_form">
          <h2><u>Add New Student</u></h2>
          <input type="text" id="roll" class="inp" placeholder="Enter Student Roll No" required />
          <input type="text" id="name" class="inp" placeholder="Enter Student Name" required />
          <input type="text" id="class" class="inp" placeholder="Enter Class" required />
          <input type="date" id="join_date" class="inp" onkeypress="return false" placeholder="Enter Date of Joining" required />
          <input type="date" id="dob" class="inp" onkeypress="return false" placeholder="Enter Date of Birth" required />
          <button onclick="addStudent()">Add Student</button>
      </div>

      <script>
          async function fetchStudents() {
              const response = await fetch("/fetch_all_students");
              const students = await response.json();
              const tbody = document.getElementById("students_body");
              tbody.innerHTML = ""; // Clear existing records
              students.forEach(student => {
                  const row = document.createElement("tr");
                  row.innerHTML = `
                      <td>${student[0]}</td>
                      <td>${student[1]}</td>
                      <td>${student[2]}</td>
                      <td>${student[3]}</td>
                      <td>${student[4]}</td>
                      <td> <button onclick="editStudent(${student[0]})">Edit</button>
                          <button onclick="deleteStudent(${student[0]})">Delete</button>
                  </td>
                  `;
                  tbody.appendChild(row);
              });
          }

          async function addStudent() {
              const roll = document.getElementById("roll").value;
              const name = document.getElementById("name").value;
              const className = document.getElementById("class").value;
              const joinDate = document.getElementById("join_date").value;
              const dob = document.getElementById("dob").value;

              // Input validation
              if (!roll || !name || !className || !joinDate || !dob) {
                  alert("Please fill in all fields.");
                  return;
              }

              await fetch("/add_student", {
                  method: "POST",
                  headers: {
                      "Content-Type": "application/json",
                  },
                  body: JSON.stringify({ roll, name, class: className, join_date: joinDate, dob }),
              });
              fetchStudents(); // Refresh the student list
          }

          async function editStudent(roll) {
              const name = prompt("Enter new name:");
              const className = prompt("Enter new class:");
              const joinDate = prompt("Enter new date of joining:");
              const dob = prompt("Enter new date of birth:");

              // Input validation
              if (!name || !className || !joinDate || !dob) {
                  alert("Please fill in all fields.");
                  return;
              }

              await fetch("/update_student", {
                  method: "POST",
                  headers: {
                      "Content-Type": "application/json",
                  },
                  body: JSON.stringify({ roll, name, class: className, join_date: joinDate, dob }),
              });
              fetchStudents(); // Refresh the student list
          }

          async function deleteStudent(roll) {
              if (confirm("Are you sure you want to delete this student?")) {
                  await fetch("/delete_student_by_id", {
                      method: "POST",
                      headers: {
                          "Content-Type": "application/json",
                      },
                      body: JSON.stringify({ roll:roll }),
                  });
                  fetchStudents(); // Refresh the student list
              }
          }

          // Initial fetch of students when the page loads
          window.onload = fetchStudents;
      </script>
        <footer>
            <p style="text-align: center;">Â© ( 2024 Vignesh R | 6095 | 2K2K- CRUZ). All rights reserved.</p>
        </footer>
  </body>
</html>